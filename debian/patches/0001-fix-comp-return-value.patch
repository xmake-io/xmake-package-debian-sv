From 2a6c2c21e45bc023569b03d288f29acb4955bb72 Mon Sep 17 00:00:00 2001
From: ruki <waruqi@gmail.com>
Date: Sun, 25 Aug 2019 22:22:08 +0800
Subject: [PATCH 1/2] fix comp return value

---
 include/semver.h | 2 +-
 src/id.c         | 6 +++---
 src/id.h         | 2 +-
 src/num.c        | 2 +-
 src/num.h        | 2 +-
 src/version.c    | 4 ++--
 6 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/include/semver.h b/include/semver.h
index 0cde4cd..5940196 100644
--- a/include/semver.h
+++ b/include/semver.h
@@ -148,7 +148,7 @@ SV_API char semver_tryn(semver_t *self, const char *str, size_t len);
 SV_API void semver_dtor(semver_t *self);
 SV_API int  semver_pwrite(const semver_t *self, char *buffer, size_t len);
 SV_API size_t semver_fwrite (const semver_t *self, FILE * stream);
-SV_API char semver_pcmp(const semver_t *self, const semver_t *other);
+SV_API int semver_pcmp(const semver_t *self, const semver_t *other);
 SV_API bool semver_comp_pmatch(const semver_t *self, const semver_comp_t *comp);
 SV_API bool semver_comp_matchn(const semver_t *self, const char *comp_str, size_t comp_len);
 SV_API bool semver_range_pmatch(const semver_t *self, const semver_range_t *range);
diff --git a/src/id.c b/src/id.c
index 7259bb3..23f2e02 100644
--- a/src/id.c
+++ b/src/id.c
@@ -93,8 +93,8 @@ char semver_id_read(semver_id_t *self, const char *str, size_t len, size_t *offs
   return 0;
 }
 
-char semver_id_pcmp(const semver_id_t *self, const semver_id_t *other) {
-  char s;
+int semver_id_pcmp(const semver_id_t *self, const semver_id_t *other) {
+  int s;
 
   if (self->len && !other->len) {
     return -1;
@@ -113,7 +113,7 @@ char semver_id_pcmp(const semver_id_t *self, const semver_id_t *other) {
     if (self->num < other->num) {
       return -1;
     }
-  } else if ((s = (char) memcmp(self->raw, other->raw, self->len > other->len ? self->len : other->len)) != 0) {
+  } else if ((s = (int) memcmp(self->raw, other->raw, self->len > other->len ? self->len : other->len)) != 0) {
     return s;
   }
 
diff --git a/src/id.h b/src/id.h
index 914b4c2..b102d2b 100644
--- a/src/id.h
+++ b/src/id.h
@@ -34,7 +34,7 @@ void semver_id_ctor(semver_id_t *self);
 void semver_id_dtor(semver_id_t *self);
 char semver_id_read(semver_id_t *self, const char *str, size_t len, size_t *offset);
 int  semver_id_pwrite(const semver_id_t *self, char *buffer, size_t len);
-char semver_id_pcmp(const semver_id_t *self, const semver_id_t *other);
+int semver_id_pcmp(const semver_id_t *self, const semver_id_t *other);
 
 #define semver_id_write(self, buffer, len) semver_id_pwrite(&(self), buffer, len)
 #define semver_id_comp(self, other) semver_id_pcmp(&(self), &(other))
diff --git a/src/num.c b/src/num.c
index 881696a..bddc381 100644
--- a/src/num.c
+++ b/src/num.c
@@ -64,7 +64,7 @@ char semver_num_read(int *self, const char *str, size_t len, size_t *offset) {
   return 0;
 }
 
-char semver_num_cmp(int self, int other) {
+int semver_num_cmp(int self, int other) {
   if (self > other) {
     return 1;
   }
diff --git a/src/num.h b/src/num.h
index 12c4b69..5ec8aa1 100644
--- a/src/num.h
+++ b/src/num.h
@@ -31,6 +31,6 @@
 #include "version.h"
 
 char semver_num_read(int *self, const char *str, size_t len, size_t *offset);
-char semver_num_cmp(int self, int other);
+int semver_num_cmp(int self, int other);
 
 #endif /* SV_NUM_H__ */
diff --git a/src/version.c b/src/version.c
index 6670a42..e961374 100644
--- a/src/version.c
+++ b/src/version.c
@@ -134,8 +134,8 @@ char semver_try_read(semver_t *self, const char *str, size_t len, size_t *offset
   return 1;
 }
 
-char semver_pcmp(const semver_t *self, const semver_t *other) {
-  char result;
+int semver_pcmp(const semver_t *self, const semver_t *other) {
+  int result;
 
   if ((result = semver_num_cmp(self->major, other->major)) != 0) {
     return result;
-- 
2.33.0

